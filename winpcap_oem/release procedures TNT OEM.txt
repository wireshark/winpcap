$Header: /usr/cvsroot/winpcap_oem/release\040procedures\040TNT\040OEM.txt,v 1.5 2006/09/13 12:34:44 gianlucav Exp $
WINPCAP PRO TOOLKIT RELEASE PROCEDURE
=====================================

Needed tools
------------
- Visual Studio .NET 2003
- The cygnus environment on your path (needed to execute step 10 and 11).


Dependencies
------------
- you need to have the Airpcap developer's pack in 
	  %BUILD_TREE%\Airpcap_Devpack
- you need to have the NpfIm compiled sources in
	  %BUILD_TREE%\NpfIm
	  You should also have run the "NpfIm\build_dev_pack.bat" script
	  to have the devpacks ready


How to compile OEM WinPcap for the toolkit.
-------------------------------------------

1.  Download winpcap (HEAD) and winpcap_oem from the CVS into %BUILD_TREE%

2.  Modify the version info into
 	  %BUILD_TREE%\winpcap_oem\version.h. 
    the version for the TNT is x.y.1.z. The variable
	  WINPCAPOEM_VER_STRING
    should be modified adding a ".tnt" at the end of the numbers.

3.  Modify the device string into
	  %BUILD_TREE%\winpcap\common\wpcapnames.h (first two defines)

4.  Download the libpcap sources (usually 0_9 branch) into 
	  %BUILD_TREE%\libpcap_<version>

5.  Commit %BUILD_TREE%\winpcap_oem\version.h into the CVS. This should be the 
    *only* modified file in this module.

6.  Tag the %BUILD_TREE%\winpcap_oem module with the tag 
	  WINPCAP_PRO_<version>_TNT_<TNT version>

7.  Tag the %BUILD_TREE%\winpcap module with the tag 
	  WINPCAP_PRO_<version>_TNT_<TNT version>

8.  Take the contents of %BUILD_TREE%\libpcap_<version> and copy it into
	  %BUILD_TREE%\winpcap\wpcap\libpcap 

9.  From the command line, go to folder 
      %BUILD_TREE%\winpcap\wpcap\libpcap

10. On the command line, type "patch -p1 < remote_code.patch"

11. CD into %BUILD_TREE%\winpcap\wpcap\prj and execute 
	"build_scanner_parser.bat"	

12. Check that the version of libpcap in
      %BUILD_TREE%\winpcap\wpcap\libpcap\pcap.c line 865
      "static const char pcap_version_string[] = "libpcap version 0.9[.x]";"
    makes sense (??? WHAT DOES IT MEAN???)

13. Check that the version of wpcap in  
      %BUILD_TREE%\winpcap\wpcap\libpcap\pcap.c line 875
        "static const char wpcap_version_string[] = "4.0";"
    is correct. 
    

14. Zip the contents of the five folders 
	  %BUILD_TREE%\winpcap_oem
	  %BUILD_TREE%\winpcap
	  %BUILD_TREE%\libpcap_<libpcap_version>
	  %BUILD_TREE%\AirPcap_Devpack
	  %BUILD_TREE%\NpfIm
		  |
		  V
	  %BUILD_TREE%\sources.zip

15. Open a Win 2000 DDK Free build environment. Go into 
	  %BUILD_TREE%\winpcap_oem\packetntx. 
	Execute "compileDriver.bat". Prefast 1.5.2402 should issue 9 warnings 
	(20070508). 
	Close the build environment.
    NOTE: DO NOT EXECUTE 15. 16. and 17. at the same time, they overwrite files in 
    the build process that are incompatible between the two builds.

16. Open the WinNT4 DDK Release build environment. Go into 
      %BUILD_TREE%\winpcap_oem\packetntx. 
    Execute "compileDriver.bat". Close the build 
    environment. 
    NOTE: DO NOT EXECUTE 15. 16. and 17. at the same time, they overwrite files in 
    the build process that are incompatible between the two builds.

17. Open the Windows Server 2003 Free x64 build environment. Go into 
      %BUILD_TREE%\winpcap_oem\packetntx. 
    Execute "compileDriver.bat". Close the build 
    environment. 
    NOTE: DO NOT EXECUTE 15. 16. and 17. at the same time, they overwrite files in 
    the build process that are incompatible between the two builds.


SIGNED BINARIES BUILD

   18s. Open %BUILD_TREE%\winpcap_oem\WinPcap OEM.sln with Visual Studio 2003. 
     Choose the "Release TNT SIGNED STEP1" configuration, and then use Build->Rebuild Solution.
     No warnings should be generated.

   19s. Sign all the binaries in 
		%BUILD_TREE%\winpcap_oem\OEM\WinPcapOem\Binaries_SIGNED, namely
			npfnt.sys
			npf2k.sys
			npfx64.sys
			packetnt.dll
			packet2k.dll
			packetVista.dll
		with the company certificate + cross certificate
		
		The generic command is
		   signtool sign /v /ac MSCV-VSClass3.cer /s my /n "CACE TECHNOLOGIES, LLC"
		   /t http://timestamp.verisign.com/scripts/timestamp.dll <binary_name>
		   
   20s. Go back to Visual studio 2003. Choose the "Release TNT SIGNED STEP2" configuration, and then
     use Build->Rebuild solution. Some warnings should be generated when compiling wpcap.dll.

	21s. Sign the following binaries in 
		%BUILD_TREE%\winpcap_oem\OEM\WinPcapOem\Binaries_SIGNED\packet.dll
		%BUILD_TREE%\winpcap_oem\OEM\WinPcapOem\Binaries_SIGNED\wpcap.dll
		with the company certificate + cross certificate


   21s. The build is complete. Check the versions *and* signature of the
   following files:
		%BUILD_TREE%\winpcap_oem\OEM\WinpcapOem\Binaries_SIGNED\wpcap.dll
		%BUILD_TREE%\winpcap_oem\OEM\WinpcapOem\Binaries_SIGNED\packet.dll
		%BUILD_TREE%\winpcap_oem\OEM\WinpcapOem\Binaries_SIGNED\npf2k.sys
		%BUILD_TREE%\winpcap_oem\OEM\WinpcapOem\Binaries_SIGNED\npfnt.sys
		%BUILD_TREE%\winpcap_oem\OEM\WinpcapOem\Binaries_SIGNED\npfx64.sys
		%BUILD_TREE%\winpcap_oem\OEM\WinpcapOem\Binaries_SIGNED\packet2k.dll
		%BUILD_TREE%\winpcap_oem\OEM\WinpcapOem\Binaries_SIGNED\packetnt.dll
		%BUILD_TREE%\winpcap_oem\OEM\WinpcapOem\Binaries_SIGNED\packetVista.dll


UNSIGNED BINARIES BUILD
(NOTE GV: as of 20070508 this procedure has not been tested at all)

18u.  Open %BUILD_TREE%\winpcap_oem\WinPcap OEM.sln with Visual Studio 2003. 
     Choose the "Release TNT" configuration, and then use Build->Rebuild Solution.
     Some warnings should be generated when compiling wpcap.dll.

19u. The build is complete. Check the versions of the following files
		%BUILD_TREE%\winpcap_oem\wpcap\PRJ\release_REMOTE_TNT\wpcap.dll
		%BUILD_TREE%\winpcap_oem\OEM\WinpcapOem\Release\packet.dll
		%BUILD_TREE%\winpcap_oem\OEM\WinpcapOem\binaries\npf2k.sys
		%BUILD_TREE%\winpcap_oem\OEM\WinpcapOem\binaries\npfnt.sys
		%BUILD_TREE%\winpcap_oem\OEM\WinpcapOem\binaries\npfx64.sys
		%BUILD_TREE%\winpcap_oem\OEM\WinpcapOem\binaries\packet2k.dll
		%BUILD_TREE%\winpcap_oem\OEM\WinpcapOem\binaries\packetnt.dll
		%BUILD_TREE%\winpcap_oem\OEM\WinpcapOem\binaries\packetVista.dll

SCM procedures
--------------

1.  %BUILD_TREE%\winpcap_oem\OEM\WinpcapOem\Binaries_SIGNED\wpcap.dll
	%BUILD_TREE%\winpcap_oem\OEM\WinpcapOem\Binaries_SIGNED\packet.dll
		|
		v
	WinPcapPro_<version>_TNT_<TNT version>_Binaries.zip

2. 	%BUILD_TREE%\Sources.zip
		|
		V
	WinPcapPro_<version>_TNT_<TNT version>_Sources.zip

3.	%BUILD_TREE%\winpcap_oem
	%BUILD_TREE%\winpcap
	%BUILD_TREE%\libpcap_<libpcap_version>
	%BUILD_TREE%\Airpcap_Devpack
	%BUILD_TREE%\NpfIm
		|
		V
	WinPcapPro_<version>_TNT_<TNT version>_Build_Tree.zip
		
		
MD5sum
------

1.  Open a command prompt and go into %BUILD_TREE%

2.  Type md5sum.exe WinPcapPro_* > md5sum.txt

		